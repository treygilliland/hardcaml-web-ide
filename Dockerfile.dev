# Hardcaml Web IDE - Development backend image
# Requires: docker build -f Dockerfile.base -t hardcaml-base .

ARG BASE_IMAGE=hardcaml-base
FROM ${BASE_IMAGE}

# Copy and pre-build dune project to warm cache
COPY hardcaml/build-cache/ /opt/build-cache/
RUN cd /opt/build-cache && dune build @runtest --force 2>/dev/null || true

# Install Python dependencies
COPY api/requirements.txt /app/requirements.txt
RUN pip3 install --break-system-packages -r /app/requirements.txt

WORKDIR /app

EXPOSE 8000

CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
